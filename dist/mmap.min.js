!function(t,e){function n(t,n){const o=e.select(t),r=o.append("svg").attr("width","100%").attr("height","100%").append("g").call(x);r.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all").on("mousedown",i),g.svg={main:r,mmap:r.append("g")},g.counter=0,g.nodes=e.map(),g.nodes.set("node"+g.counter,{x:parseInt(o.style("width"))/2,y:parseInt(o.style("height"))/2,background:"#e6e6e6",textColor:"#828c82",font:18,name:"Root node"}),m("node0"),d()}function o(){g.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).selectAll("ellipse").attr("stroke","#888888"),m(t.key)}function a(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>l(t))}function i(){e.selectAll(".node > ellipse").attr("stroke","none"),g.selected="node0"}function s(t){for(var e=t.parent,n=0;e;)n++,e=e.parent;return n<5?n:5}function l(t){const n=30-5*s(t),o=t.parent.y<t.y?-1:1,r=t.parent.x>t.x?-1:1,a=(t.parent.x+t.x)/2,i=t.k=t.k||e.randomUniform(50)(),l=e.path();return l.moveTo(t.parent.x,t.parent.y-n/2),l.bezierCurveTo(a,t.parent.y-n/2,t.parent.x+i*r,t.y+t.height/2+5+i/10,t.x-(t.width/4-i/2)*r,t.y+t.height/2+5+i/10),l.bezierCurveTo(t.parent.x+i*r+n/2*o*r,t.y+t.height/2+n/2+5+i/10,a+n/2*o*r,t.parent.y+n/2,t.parent.x,t.parent.y+n/2),l.closePath(),l}function c(){const t=[];return g.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function d(){const t=c(),n=g.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("transform",t=>"translate("+t.x+","+t.y+")").call(y);o.append("text").text(t=>t.name).attr("fill",t=>t.textColor).attr("font-size",t=>t.font).attr("dy",5),o.append("ellipse").style("fill",t=>t.background).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=this.previousSibling.getBBox().height+20,t.height/2}),n.exit().remove();const r=g.svg.mmap.selectAll(".link").data(t.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",t=>t.linkColor).style("stroke",t=>t.linkColor).attr("d",t=>l(t)),r.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function f(t){if(g.selected){const e=g.nodes.get(g.selected),n=g.nodes.get("node0");g.nodes.set("node"+ ++g.counter,{parent:e,x:e.x+(e.x>n.x?200:-200),y:e.y+50,background:t.background||"#f1f1f1",textColor:t.textColor||"#9a9a9a",linkColor:t.linkColor||"#9fad9c",font:t.font||15,name:t.name||"Node"}),d()}}function p(){if("node0"!==g.selected){g.nodes.remove(g.selected);const t=function(e){g.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===e)return g.nodes.remove(n.key),void t(n.key)})};t(g.selected),i(),e.selectAll(".node, .link").remove(),d()}}function u(){g.svg.main.transition().duration(500).call(x.transform,e.zoomIdentity)}function h(){return g.nodes.values()}function m(t){g.selected=t}const g={},x=e.zoom().scaleExtent([.5,2]).on("zoom",o),y=e.drag().on("drag",a).on("start",r);t.mmap={init:n,createNode:f,getNodes:h,removeNode:p,selectNode:m,centerMap:u}}(this,window.d3);