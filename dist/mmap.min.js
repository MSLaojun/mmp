!function(t,e){function n(t){x.container=e.select(t),x.svg={},x.svg.main=x.container.append("svg").attr("width","100%").attr("height","100%").attr("id","mmap").append("g").call(b),x.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",s),x.svg.mmap=x.svg.main.append("g"),x.nodes=e.map(),x.counter=0,x.nodes.set("node"+x.counter,{name:"Root node",x:parseInt(x.container.style("width"))/2,y:parseInt(x.container.style("height"))/2,"background-color":"#e6ede6","text-color":"#828c82","font-size":20,"font-style":"normal","font-weight":"normal"}),a(),i("node0"),N.call("mmcreate")}function o(){x.svg.mmap.attr("transform",e.event.transform.toString())}function l(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>drawLink(t))}function i(t){if(x.selected!==t||"node0"===x.selected){x.selected=t;const n=e.select("#"+t);e.selectAll(".node > ellipse").attr("stroke","none"),n.select("ellipse").attr("stroke","#587d53"),N.call("nodeselect",n.node(),x.nodes.get(t))}}function s(){i("node0"),e.selectAll(".node > ellipse").attr("stroke","none")}function c(){const t=[];return x.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function r(){e.selectAll(".node, .link").remove(),a()}function a(){const t=c(),n=x.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("id",t=>t.key).attr("transform",t=>"translate("+t.x+","+t.y+")").call(z).on("dblclick",function(t){N.call("nodedblclick",this,t),e.event.stopPropagation()});o.append("text").text(t=>t.name).attr("fill",t=>t["text-color"]).attr("font-size",t=>t["font-size"]).attr("font-style",t=>t["font-style"]).attr("font-weight",t=>t["font-weight"]),o.append("ellipse").style("fill",t=>t["background-color"]).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=11*t["font-size"]/10+30,t.height/2}),n.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)});const l=x.svg.mmap.selectAll(".link").data(t.slice(1));l.enter().insert("path","g").attr("class","link").attr("id",t=>"linkOf"+t.key).style("fill",t=>t["link-color"]).style("stroke",t=>t["link-color"]).attr("d",t=>drawLink(t)),l.exit().remove()}function d(t,e){const n=this.childNodes[1],o=this.childNodes[0];t.name=n.innerHTML=e,t.width=n.textLength.baseVal.value+40,o.setAttribute("rx",t.width/2)}function f(t,e){const n=this.childNodes[0];n.style.setProperty("fill",t["background-color"]=e)}function h(t,e){const n=this.childNodes[1];n.style.setProperty("fill",t["text-color"]=e)}function u(t,n){const o=this.childNodes[1],l=this.childNodes[0];o.style.setProperty("font-size",t["font-size"]=n),t.width=o.textLength.baseVal.value+40,t.height=11*t["font-size"]/10+30,l.setAttribute("rx",t.width/2),l.setAttribute("ry",t.height/2),e.selectAll(".link").attr("d",t=>drawLink(t))}function m(t){const e=this.childNodes[1];t["font-style"]="normal"===t["font-style"]?"italic":"normal",e.style.setProperty("font-style",t["font-style"])}function y(t){const e=this.childNodes[1];t["font-weight"]="normal"===t["font-weight"]?"bold":"normal",e.style.setProperty("font-weight",t["font-weight"])}function g(t,e){if("node0"!==t.key){const n=document.getElementById("linkOf"+t.key);n.style.setProperty("fill",t["link-color"]=e),n.style.setProperty("stroke",t["link-color"]=e)}else console.warn("The root node has no branches")}function p(t){if(x.selected){const e=x.nodes.get(x.selected),n=x.nodes.get("node0"),o="node"+ ++x.counter,l={name:t&&t.name||"Node","background-color":t&&t["background-color"]||"#f1f1f1","text-color":t&&t["text-color"]||"#808080","link-color":t&&t["link-color"]||"#9fad9c","font-size":t&&t["font-size"]||16,"font-style":t&&t["font-style"]||"normal","font-weight":t&&t["font-weight"]||"normal",x:e.x+(e.x>n.x?200:-200),y:e.y+50,parent:e};x.nodes.set(o,l),a(),N.call("nodecreate")}}function k(){if("node0"!==x.selected){x.nodes.remove(x.selected);const t=function(e){x.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===e)return x.nodes.remove(n.key),void t(n.key)})};t(x.selected),x.selected="node0",r(),N.call("noderemove")}else console.warn("The root node can not be deleted")}function v(){x.svg.main.transition().duration(500).call(b.transform,e.zoomIdentity),N.call("mmcenter")}function w(t,e){const n=x.nodes.get(x.selected),o=document.getElementById(n.key),l={name:d,"background-color":f,"link-color":g,"text-color":h,"font-size":u,"font-style":m,"font-weight":y,default:function(){console.error('"'+t+'" is not a valid node property')}};(l[t]||l.default).call(o,n,e)}const x={},b=e.zoom().scaleExtent([.5,2]).on("zoom",o),z=e.drag().on("drag",l).on("start",function(t){i(t.key)}),N=e.dispatch("mmcreate","mmcenter","nodeselect","nodecreate","noderemove","nodedblclick");t.mmap={init:n,center:v,addNode:p,removeNode:k,updateNode:w,events:N}}(this,window.d3);