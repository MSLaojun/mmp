!function(e,t){function n(n){N.container=t.select(n),N.svg={},N.svg.main=N.container.append("svg").attr("width","100%").attr("height","100%").attr("id","mmap").append("g").call(P),N.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("click",s),N.svg.mmap=N.svg.main.append("g"),N.nodes=t.map(),N.counter=0,N.nodes.set("node"+N.counter,{name:"Root node",x:parseInt(N.container.style("width"))/2,y:parseInt(N.container.style("height"))/2,"background-color":"#e6ede6","text-color":"#828c82","font-size":20,"font-style":"normal","font-weight":"normal"}),d(),s(),e.onresize=b,I.call("mmcreate")}function o(){N.svg.mmap.attr("transform",t.event.transform)}function r(e){const n=e.x=t.event.x,o=e.y=t.event.y;t.select(this).attr("transform","translate("+n+","+o+")"),t.selectAll(".link").attr("d",k)}function l(e){if(N.selected!==e||"node0"===N.selected){t.selectAll(".node > path").style("stroke","none"),N.selected=e;const n=t.select("#"+e),o=n.select("path");o.style("stroke",t.color(o.style("fill")).darker(.5)),I.call("nodeselect",n.node(),N.nodes.get(e))}}function s(){l("node0"),t.select("#node0 > path").style("stroke","none")}function i(e){for(var t=e.parent,n=0;t;)n++,t=t.parent;return n<5?n:5}function c(){const e=[];return N.nodes.each(function(t,n){t.key=n,e.push(t)}),e}function a(){t.selectAll(".node, .link").remove(),d()}function d(){const e=c(),n=N.svg.mmap.selectAll(".node").data(e),o=n.enter().append("g").attr("class","node").attr("id",e=>e.key).attr("transform",e=>"translate("+e.x+","+e.y+")").call(T).on("dblclick",function(e){I.call("nodedblclick",this,e),t.event.stopPropagation()});o.append("text").text(e=>e.name).attr("fill",e=>e["text-color"]).attr("font-size",e=>e["font-size"]).attr("font-style",e=>e["font-style"]).attr("font-weight",e=>e["font-weight"]),o.insert("path","text").style("fill",e=>e["background-color"]).attr("d",v),n.exit().remove();const r=N.svg.mmap.selectAll(".link").data(e.slice(1));r.enter().insert("path","g").attr("class","link").attr("id",e=>"linkOf"+e.key).style("fill",e=>e["link-color"]).style("stroke",e=>e["link-color"]).attr("d",k),r.exit().remove()}function f(e,n){const o=this.childNodes[1],r=this.childNodes[0];e.name=o.innerHTML=n,e.width=o.textLength.baseVal.value+45,t.select(r).attr("d",v)}function h(e,n){const o=this.childNodes[0];o.style.setProperty("fill",e["background-color"]=n),o.style.setProperty("stroke",t.color(n).darker(.5))}function y(e,t){const n=this.childNodes[1];n.style.setProperty("fill",e["text-color"]=t)}function u(e,n){const o=this.childNodes[1],r=this.childNodes[0];o.style.setProperty("font-size",e["font-size"]=n),e.width=o.textLength.baseVal.value+45,e.height=11*e["font-size"]/10+30,t.select(r).attr("d",v),t.selectAll(".link").attr("d",k)}function m(e){const t=this.childNodes[1];e["font-style"]="normal"===e["font-style"]?"italic":"normal",t.style.setProperty("font-style",e["font-style"])}function p(e){const t=this.childNodes[1];e["font-weight"]="normal"===e["font-weight"]?"bold":"normal",t.style.setProperty("font-weight",e["font-weight"])}function g(e,t){if("node0"!==e.key){const n=document.getElementById("linkOf"+e.key);n.style.setProperty("fill",e["link-color"]=t),n.style.setProperty("stroke",e["link-color"]=t)}else console.warn("The root node has no branches")}function k(e){const n=22-3*i(e),o=(e.parent.x+e.x)/2,r=e.parent.y<e.y+e.height/2?-1:1,l=e.parent.x>e.x?-1:1,s=l*r,c=t.path();return c.moveTo(e.parent.x,e.parent.y-.8*n),c.bezierCurveTo(o-n*s,e.parent.y-n/2,e.parent.x-n/2*s,e.y+e.height/2-n/3,e.x-e.width/3*l,e.y+e.height/2+3),c.bezierCurveTo(e.parent.x+n/2*s,e.y+e.height/2+n/3,o+n*s,e.parent.y+n/2,e.parent.x,e.parent.y+.8*n),c.closePath(),c}function v(e){const n=t.path(),o=(e.width=this.nextSibling.getBBox().width+45)/2,r=(e.height=11*e["font-size"]/10+30)/2,l=e.k=e.k||t.randomUniform(-20,20)();return n.moveTo(-o,l/3),n.bezierCurveTo(-o,-r+10,-o+10,-r,l,-r),n.bezierCurveTo(o-10,-r,o,-r+10,o,l/3),n.bezierCurveTo(o,r-10,o-10,r,l,r),n.bezierCurveTo(-o+10,r,-o,r-10,-o,l/3),n.closePath(),n}function x(e){if(N.selected){const t=N.nodes.get(N.selected),n=N.nodes.get("node0"),o="node"+ ++N.counter,r={name:e&&e.name||"Node","background-color":e&&e["background-color"]||"#f1f1f1","text-color":e&&e["text-color"]||"#808080","link-color":e&&e["link-color"]||"#9fad9c","font-size":e&&e["font-size"]||16,"font-style":e&&e["font-style"]||"normal","font-weight":e&&e["font-weight"]||"normal",x:t.x+(t.x>n.x?200:-200),y:t.y+50,parent:t};N.nodes.set(o,r),d(),I.call("nodecreate")}}function w(){if("node0"!==N.selected){N.nodes.remove(N.selected);const e=function(t){N.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===t)return N.nodes.remove(n.key),void e(n.key)})};e(N.selected),l("node0"),a(),I.call("noderemove")}else console.warn("The root node can not be deleted")}function b(){const e=N.nodes.get("node0"),n={x:parseInt(N.container.style("width"))/2,y:parseInt(N.container.style("height"))/2},o=t.zoomIdentity.translate(n.x-e.x,n.y-e.y);N.svg.main.transition().duration(500).call(P.transform,o),I.call("mmcenter")}function z(e,t){const n=N.nodes.get(N.selected),o=document.getElementById(n.key),r={name:f,"background-color":h,"link-color":g,"text-color":y,"font-size":u,"font-style":m,"font-weight":p,default:function(){console.error('"'+e+'" is not a valid node property')}};(r[e]||r.default).call(o,n,t)}const N={},P=t.zoom().scaleExtent([.5,2]).on("zoom",o),T=t.drag().on("drag",r).on("start",function(e){l(e.key)}),I=t.dispatch("mmcreate","mmcenter","nodeselect","nodecreate","noderemove","nodedblclick");e.mmap={init:n,center:b,addNode:x,removeNode:w,updateNode:z,events:I}}(this,window.d3);