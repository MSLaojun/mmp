!function(t,e){function n(t,n){const o=e.select(t),r=o.append("svg").attr("width","100%").attr("height","100%").append("g").call(g);r.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all").on("mousedown",s),m.svg={main:r,mmap:r.append("g")},m.counter=0,m.nodes=e.map(),m.nodes.set("node"+m.counter,{x:parseInt(o.style("width"))/2,y:parseInt(o.style("height"))/2,background:"#f5f5f5",color:"#8d9f8e",font:18,name:"Root node"}),u("node0"),i()}function o(){m.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).selectAll("ellipse").attr("stroke","#888888"),u(t.key)}function a(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>l(t))}function s(){e.selectAll(".node > ellipse").attr("stroke","none"),m.selected="node0"}function l(t){const n=e.path();return n.moveTo(t.parent.x,t.parent.y-5),n.bezierCurveTo((t.parent.x+t.x)/2,t.parent.y,(t.parent.x+t.x)/2,t.y,t.x-20,t.y+20),n.bezierCurveTo((t.x+t.parent.x)/2+10,t.y,(t.x+t.parent.x)/2+10,t.parent.y,t.parent.x,t.parent.y+5),n.closePath(),n}function c(){const t=[];return m.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function i(){const t=c(),n=m.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("transform",t=>"translate("+t.x+","+t.y+")").call(h);o.append("text").text(t=>t.name).attr("fill",t=>t.color).attr("font-size",t=>t.font).attr("dy",5),o.append("ellipse").style("fill",t=>t.background).attr("rx",function(){return this.previousSibling.getBBox().width/2+20}).attr("ry",function(){return this.previousSibling.getBBox().height/2+10}),n.exit().remove();const r=m.svg.mmap.selectAll(".link").data(t.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",t=>t.color).style("stroke",t=>t.color).attr("d",t=>l(t)),r.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function d(t){if(m.selected){const e=m.nodes.get(m.selected);m.nodes.set("node"+ ++m.counter,{parent:e,x:e.x+200,y:e.y+50,background:t.background||"#e6e6e6",color:t.color||"#6f6f6f",font:t.font||15,name:t.name||"Node"}),i()}}function f(){"node0"!==m.selected&&(m.nodes.remove(m.selected),s(),i())}function p(){return m.nodes.values()}function u(t){m.selected=t}const m={},g=e.zoom().scaleExtent([.5,2]).on("zoom",o),h=e.drag().on("drag",a).on("start",r);t.mmap={init:n,createNode:d,getNodes:p,deleteNode:f,selectNode:u}}(this,window.d3);