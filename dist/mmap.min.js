!function(t,e){function n(t){y.container=e.select(t),y.svg={},y.svg.main=y.container.append("svg").attr("width","100%").attr("height","100%").append("g").call(x),y.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",a),y.svg.mmap=y.svg.main.append("g"),y.nodes=e.map(),y.counter=0,y.nodes.set("node"+y.counter,{x:parseInt(y.container.style("width"))/2,y:parseInt(y.container.style("height"))/2,background:"#e6ede6",textColor:"#828c82",font:18,name:"Root node"}),y.selected="node0",d()}function o(){y.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).select("ellipse").attr("stroke","#888888"),y.selected=t.key}function i(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>l(t))}function a(){e.selectAll(".node > ellipse").attr("stroke","none"),y.selected="node0"}function s(t){for(var e=t.parent,n=0;e;)n++,e=e.parent;return n<5?n:5}function l(t){const n=30-5*s(t),o=t.parent.y<t.y?-1:1,r=t.parent.x>t.x?-1:1,i=(t.parent.x+t.x)/2,a=t.k=t.k||e.randomUniform(50)(),l=e.path();return l.moveTo(t.parent.x,t.parent.y-n/2),l.bezierCurveTo(i,t.parent.y-n/2,t.parent.x+a*r,t.y+t.height/2+5+a/10,t.x-(t.width/4-a/2)*r,t.y+t.height/2+5+a/10),l.bezierCurveTo(t.parent.x+a*r+n/2*o*r,t.y+t.height/2+n/2+5+a/10,i+n/2*o*r,t.parent.y+n/2,t.parent.x,t.parent.y+n/2),l.closePath(),l}function c(){const t=[];return y.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function d(){const t=c(),n=y.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("id",t=>t.key).attr("transform",t=>"translate("+t.x+","+t.y+")").call(v);o.append("text").text(t=>t.name).attr("fill",t=>t.textColor).attr("font-size",t=>t.font).attr("dy",5),o.append("ellipse").style("fill",t=>t.background).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=this.previousSibling.getBBox().height+20,t.height/2}),n.exit().remove();const r=y.svg.mmap.selectAll(".link").data(t.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",t=>t.linkColor).style("stroke",t=>t.linkColor).attr("d",t=>l(t)),r.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function u(){e.selectAll(".node, .link").remove(),d()}function f(t,e){const n=document.getElementById(t.key),o=n.childNodes[1],r=n.childNodes[0];t.name=o.innerHTML=e,t.width=o.textLength.baseVal.value+40,r.setAttribute("rx",t.width/2)}function p(t){if(y.selected){const e=y.nodes.get(y.selected),n=y.nodes.get("node0");y.nodes.set("node"+ ++y.counter,{parent:e,x:e.x+(e.x>n.x?200:-200),y:e.y+50,background:t&&t.background||"#f1f1f1",textColor:t&&t.textColor||"#808080",linkColor:t&&t.linkColor||"#9fad9c",font:t&&t.font||15,name:t&&t.name||"Node"}),d()}}function h(){if("node0"!==y.selected){y.nodes.remove(y.selected);const t=function(e){y.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===e)return y.nodes.remove(n.key),void t(n.key)})};t(y.selected),y.selected="node0",u()}}function m(){y.svg.main.transition().duration(500).call(x.transform,e.zoomIdentity)}function g(t,e){const n=y.nodes.get(y.selected),o={name:f,default:function(){console.warn('"'+t+'" is not a valid node property')}};(o[t]||o.default)(n,e)}const y={},x=e.zoom().scaleExtent([.5,2]).on("zoom",o),v=e.drag().on("drag",i).on("start",r);t.mmap={init:n,center:m,addNode:p,removeNode:h,updateNode:g}}(this,window.d3);