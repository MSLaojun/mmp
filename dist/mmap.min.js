!function(e,t){function n(e){const n=t.select(e),o=n.append("svg").attr("width","100%").attr("height","100%").append("g").call(x);o.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all").on("mousedown",a),y.svg={main:o,mmap:o.append("g")},y.counter=0,y.nodes=t.map(),y.nodes.set("node"+y.counter,{x:parseInt(n.style("width"))/2,y:parseInt(n.style("height"))/2,background:"#e6e6e6",textColor:"#828c82",font:18,name:"Root node"}),y.selected="node0",u()}function o(){y.svg.mmap.attr("transform",t.event.transform.toString())}function r(e){t.selectAll(".node > ellipse").attr("stroke","none"),t.select(this).selectAll("ellipse").attr("stroke","#888888"),y.selected=e.key}function i(e){const n=e.x=t.event.x,o=e.y=t.event.y;t.select(this).attr("transform","translate("+n+","+o+")"),t.selectAll(".link").attr("d",e=>s(e))}function a(){t.selectAll(".node > ellipse").attr("stroke","none"),y.selected="node0"}function l(e){for(var t=e.parent,n=0;t;)n++,t=t.parent;return n<5?n:5}function s(e){const n=30-5*l(e),o=e.parent.y<e.y?-1:1,r=e.parent.x>e.x?-1:1,i=(e.parent.x+e.x)/2,a=e.k=e.k||t.randomUniform(50)(),s=t.path();return s.moveTo(e.parent.x,e.parent.y-n/2),s.bezierCurveTo(i,e.parent.y-n/2,e.parent.x+a*r,e.y+e.height/2+5+a/10,e.x-(e.width/4-a/2)*r,e.y+e.height/2+5+a/10),s.bezierCurveTo(e.parent.x+a*r+n/2*o*r,e.y+e.height/2+n/2+5+a/10,i+n/2*o*r,e.parent.y+n/2,e.parent.x,e.parent.y+n/2),s.closePath(),s}function c(){const e=[];return y.nodes.each(function(t,n){t.key=n,e.push(t)}),e}function d(e){const n=this,o=document.createElement("input");o.type="text",o.style=`
            position: absolute;
            top: ${t.event.y-70}px;
            left: ${t.event.x-40}px;
            padding: 5px;
            background-color: transparent
        `,o.value=this.childNodes[1].innerHTML,document.body.appendChild(o).focus(),o.onblur=function(){o.remove()},o.onkeyup=function(t){if("Enter"===t.key)o.blur();else{const t=n.childNodes[1],r=n.childNodes[0];e.name=t.innerHTML=o.value,e.width=t.textLength.baseVal.value+40,r.setAttribute("rx",e.width/2),r.setAttribute("ry",e.height/2)}},t.event.stopPropagation()}function u(){const e=c(),n=y.svg.mmap.selectAll(".node").data(e),o=n.enter().append("g").attr("class","node").attr("transform",e=>"translate("+e.x+","+e.y+")").call(v).on("dblclick.zoom",null).on("dblclick",d);o.append("text").text(e=>e.name).attr("fill",e=>e.textColor).attr("font-size",e=>e.font).attr("dy",5),o.append("ellipse").style("fill",e=>e.background).attr("rx",function(e){return e.width=this.previousSibling.getBBox().width+40,e.width/2}).attr("ry",function(e){return e.height=this.previousSibling.getBBox().height+20,e.height/2}),n.exit().remove();const r=y.svg.mmap.selectAll(".link").data(e.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",e=>e.linkColor).style("stroke",e=>e.linkColor).attr("d",e=>s(e)),r.exit().remove(),t.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function p(){t.selectAll(".node, .link").remove(),u()}function f(e){if(y.selected){const t=y.nodes.get(y.selected),n=y.nodes.get("node0");y.nodes.set("node"+ ++y.counter,{parent:t,x:t.x+(t.x>n.x?200:-200),y:t.y+50,background:e&&e.background||"#f1f1f1",textColor:e&&e.textColor||"#9a9a9a",linkColor:e&&e.linkColor||"#9fad9c",font:e&&e.font||15,name:e&&e.name||"Node"}),u()}}function h(){if("node0"!==y.selected){y.nodes.remove(y.selected);const e=function(t){y.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===t)return y.nodes.remove(n.key),void e(n.key)})};e(y.selected),y.selected="node0",p()}}function m(){y.svg.main.transition().duration(500).call(x.transform,t.zoomIdentity)}function g(e,t){const n=y.nodes.get(y.selected);e in n&&(n[e]=t,p())}const y={},x=t.zoom().scaleExtent([.5,2]).on("zoom",o),v=t.drag().on("drag",i).on("start",r);e.mmap={init:n,center:m,addNode:f,removeNode:h,updateNode:g}}(this,window.d3);