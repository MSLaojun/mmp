!function(t,e){function n(t,n){const o=e.select(t),r=o.append("svg").attr("width","100%").attr("height","100%").append("g").call(g);r.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all").on("mousedown",a),u.svg={main:r,mmap:r.append("g")},u.counter=0,u.nodes=e.map(),u.nodes.set("node"+u.counter,{x:parseInt(o.style("width"))/2,y:parseInt(o.style("height"))/2,background:"#f5f5f5",color:"#8d9f8e",font:18,name:"Root node"}),p("node0"),c()}function o(){u.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).selectAll("ellipse").attr("stroke","#888888"),p(t.key)}function i(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>s(t))}function a(){e.selectAll(".node > ellipse").attr("stroke","none"),u.selected="node0"}function s(t){const n=e.path();return n.moveTo(t.parent.x,t.parent.y-5),n.bezierCurveTo((t.parent.x+t.x-t.width/2)/2,t.parent.y-5,(t.parent.x+t.x-t.width/2)/2,t.y+t.height/2+5,t.x-t.width/2,t.y+t.height/2+5),n.lineTo(t.x,t.y+t.height/2+7),n.lineTo(t.x-t.width/2,t.y+t.height/2+10),n.bezierCurveTo((t.parent.x+t.x-t.width/2)/2+5,t.y+t.height/2+10,(t.parent.x+t.x-t.width/2)/2+10,t.parent.y-5,t.parent.x,t.parent.y+5),n.closePath(),n}function l(){const t=[];return u.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function c(){const t=l(),n=u.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("transform",t=>"translate("+t.x+","+t.y+")").call(x);o.append("text").text(t=>t.name).attr("fill",t=>t.color).attr("font-size",t=>t.font).attr("dy",5),o.append("ellipse").style("fill",t=>t.background).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=this.previousSibling.getBBox().height+20,t.height/2}),n.exit().remove();const r=u.svg.mmap.selectAll(".link").data(t.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",t=>t.color).style("stroke",t=>"none").attr("d",t=>s(t)),r.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function d(t){if(u.selected){const e=u.nodes.get(u.selected);u.nodes.set("node"+ ++u.counter,{parent:e,x:e.x+200,y:e.y+50,background:t.background||"#e6e6e6",color:t.color||"#6f6f6f",font:t.font||15,name:t.name||"Node"}),c()}}function h(){"node0"!==u.selected&&(u.nodes.remove(u.selected),a(),c())}function f(){return u.nodes.values()}function p(t){u.selected=t}const u={},g=e.zoom().scaleExtent([.5,2]).on("zoom",o),x=e.drag().on("drag",i).on("start",r);t.mmap={init:n,createNode:d,getNodes:f,deleteNode:h,selectNode:p}}(this,window.d3);