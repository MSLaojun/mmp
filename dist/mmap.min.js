!function(t,e){function n(t){z.container=e.select(t),z.svg={},z.svg.main=z.container.append("svg").attr("width","100%").attr("height","100%").attr("id","mmap").append("g").call(N),z.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",r),z.svg.mmap=z.svg.main.append("g"),z.nodes=e.map(),z.counter=0,z.nodes.set("node"+z.counter,{name:"Root node",x:parseInt(z.container.style("width"))/2,y:parseInt(z.container.style("height"))/2,"background-color":"#e6ede6","text-color":"#828c82","font-size":20,"font-style":"normal","font-weight":"normal"}),d(),i("node0"),P.call("mmcreate")}function o(){z.svg.mmap.attr("transform",e.event.transform.toString())}function l(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>k(t))}function i(t){if(z.selected!==t||"node0"===z.selected){z.selected=t;const n=e.select("#"+t);e.selectAll(".node > ellipse").attr("stroke","none"),n.select("ellipse").attr("stroke","#587d53"),P.call("nodeselect",n.node(),z.nodes.get(t))}}function r(){i("node0"),e.selectAll(".node > ellipse").attr("stroke","none")}function s(t){for(var e=t.parent,n=0;e;)n++,e=e.parent;return n<5?n:5}function c(){const t=[];return z.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function a(){e.selectAll(".node, .link").remove(),d()}function d(){const t=c(),n=z.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("id",t=>t.key).attr("transform",t=>"translate("+t.x+","+t.y+")").call(A).on("dblclick",function(t){P.call("nodedblclick",this,t),e.event.stopPropagation()});o.append("text").text(t=>t.name).attr("fill",t=>t["text-color"]).attr("font-size",t=>t["font-size"]).attr("font-style",t=>t["font-style"]).attr("font-weight",t=>t["font-weight"]),o.append("ellipse").style("fill",t=>t["background-color"]).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=11*t["font-size"]/10+30,t.height/2}),n.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)});const l=z.svg.mmap.selectAll(".link").data(t.slice(1));l.enter().insert("path","g").attr("class","link").attr("id",t=>"linkOf"+t.key).style("fill",t=>t["link-color"]).style("stroke",t=>t["link-color"]).attr("d",t=>k(t)),l.exit().remove()}function f(t,e){const n=this.childNodes[1],o=this.childNodes[0];t.name=n.innerHTML=e,t.width=n.textLength.baseVal.value+40,o.setAttribute("rx",t.width/2)}function h(t,e){const n=this.childNodes[0];n.style.setProperty("fill",t["background-color"]=e)}function u(t,e){const n=this.childNodes[1];n.style.setProperty("fill",t["text-color"]=e)}function m(t,n){const o=this.childNodes[1],l=this.childNodes[0];o.style.setProperty("font-size",t["font-size"]=n),t.width=o.textLength.baseVal.value+40,t.height=11*t["font-size"]/10+30,l.setAttribute("rx",t.width/2),l.setAttribute("ry",t.height/2),e.selectAll(".link").attr("d",t=>k(t))}function p(t){const e=this.childNodes[1];t["font-style"]="normal"===t["font-style"]?"italic":"normal",e.style.setProperty("font-style",t["font-style"])}function y(t){const e=this.childNodes[1];t["font-weight"]="normal"===t["font-weight"]?"bold":"normal",e.style.setProperty("font-weight",t["font-weight"])}function g(t,e){if("node0"!==t.key){const n=document.getElementById("linkOf"+t.key);n.style.setProperty("fill",t["link-color"]=e),n.style.setProperty("stroke",t["link-color"]=e)}else console.warn("The root node has no branches")}function k(t){const n=30-5*s(t),o=t.parent.y<t.y?-1:1,l=t.parent.x>t.x?-1:1,i=(t.parent.x+t.x)/2,r=t.k=t.k||e.randomUniform(50)(),c=e.path();return c.moveTo(t.parent.x,t.parent.y-n/2),c.bezierCurveTo(i,t.parent.y-n/2,t.parent.x+r*l,t.y+t.height/2+5+r/10,t.x-(t.width/4-r/2)*l,t.y+t.height/2+5+r/10),c.bezierCurveTo(t.parent.x+r*l+n/2*o*l,t.y+t.height/2+n/2+5+r/10,i+n/2*o*l,t.parent.y+n/2,t.parent.x,t.parent.y+n/2),c.closePath(),c}function x(t){if(z.selected){const e=z.nodes.get(z.selected),n=z.nodes.get("node0"),o="node"+ ++z.counter,l={name:t&&t.name||"Node","background-color":t&&t["background-color"]||"#f1f1f1","text-color":t&&t["text-color"]||"#808080","link-color":t&&t["link-color"]||"#9fad9c","font-size":t&&t["font-size"]||16,"font-style":t&&t["font-style"]||"normal","font-weight":t&&t["font-weight"]||"normal",x:e.x+(e.x>n.x?200:-200),y:e.y+50,parent:e};z.nodes.set(o,l),d(),P.call("nodecreate")}}function v(){if("node0"!==z.selected){z.nodes.remove(z.selected);const t=function(e){z.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===e)return z.nodes.remove(n.key),void t(n.key)})};t(z.selected),z.selected="node0",a(),P.call("noderemove")}else console.warn("The root node can not be deleted")}function w(){z.svg.main.transition().duration(500).call(N.transform,e.zoomIdentity),P.call("mmcenter")}function b(t,e){const n=z.nodes.get(z.selected),o=document.getElementById(n.key),l={name:f,"background-color":h,"link-color":g,"text-color":u,"font-size":m,"font-style":p,"font-weight":y,default:function(){console.error('"'+t+'" is not a valid node property')}};(l[t]||l.default).call(o,n,e)}const z={},N=e.zoom().scaleExtent([.5,2]).on("zoom",o),A=e.drag().on("drag",l).on("start",function(t){i(t.key)}),P=e.dispatch("mmcreate","mmcenter","nodeselect","nodecreate","noderemove","nodedblclick");t.mmap={init:n,center:w,addNode:x,removeNode:v,updateNode:b,events:P}}(this,window.d3);