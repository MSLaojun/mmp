!function(e,t){function n(e){v.container=t.select(e),v.svg={},v.svg.main=v.container.append("svg").attr("width","100%").attr("height","100%").append("g").call(y),v.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",i),v.svg.mmap=v.svg.main.append("g"),v.nodes=t.map(),v.counter=0,v.nodes.set("node"+v.counter,{x:parseInt(v.container.style("width"))/2,y:parseInt(v.container.style("height"))/2,background:"#e6ede6",textColor:"#828c82",font:18,name:"Root node"}),d(),a("node0"),k.call("mmcreate")}function o(){v.svg.mmap.attr("transform",t.event.transform.toString())}function r(e){const n=e.x=t.event.x,o=e.y=t.event.y;t.select(this).attr("transform","translate("+n+","+o+")"),t.selectAll(".link").attr("d",e=>u(e))}function a(e){if(v.selected!==e){v.selected=e;const n=t.select("#"+e);t.selectAll(".node > ellipse").attr("stroke","none"),n.select("ellipse").attr("stroke","#888888"),k.call("nodeselect",n.node(),v.nodes.get(e))}}function i(){t.selectAll(".node > ellipse").attr("stroke","none"),v.selected="node0"}function l(e){for(var t=e.parent,n=0;t;)n++,t=t.parent;return n<5?n:5}function c(){const e=[];return v.nodes.each(function(t,n){t.key=n,e.push(t)}),e}function s(){t.selectAll(".node, .link").remove(),d()}function d(){const e=c(),n=v.svg.mmap.selectAll(".node").data(e),o=n.enter().append("g").attr("class","node").attr("id",e=>e.key).attr("transform",e=>"translate("+e.x+","+e.y+")").call(x).on("dblclick",function(e){k.call("nodedblclick",this,e),t.event.stopPropagation()});o.append("text").text(e=>e.name).attr("fill",e=>e.textColor).attr("font-size",e=>e.font).attr("dy",5),o.append("ellipse").style("fill",e=>e.background).attr("rx",function(e){return e.width=this.previousSibling.getBBox().width+40,e.width/2}).attr("ry",function(e){return e.height=this.previousSibling.getBBox().height+20,e.height/2}),n.exit().remove();const r=v.svg.mmap.selectAll(".link").data(e.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",e=>e.linkColor).style("stroke",e=>e.linkColor).attr("d",e=>u(e)),r.exit().remove(),t.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function f(e,t){const n=document.getElementById(e.key),o=n.childNodes[1],r=n.childNodes[0];e.name=o.innerHTML=t,e.width=o.textLength.baseVal.value+40,r.setAttribute("rx",e.width/2)}function u(e){const n=30-5*l(e),o=e.parent.y<e.y?-1:1,r=e.parent.x>e.x?-1:1,a=(e.parent.x+e.x)/2,i=e.k=e.k||t.randomUniform(50)(),c=t.path();return c.moveTo(e.parent.x,e.parent.y-n/2),c.bezierCurveTo(a,e.parent.y-n/2,e.parent.x+i*r,e.y+e.height/2+5+i/10,e.x-(e.width/4-i/2)*r,e.y+e.height/2+5+i/10),c.bezierCurveTo(e.parent.x+i*r+n/2*o*r,e.y+e.height/2+n/2+5+i/10,a+n/2*o*r,e.parent.y+n/2,e.parent.x,e.parent.y+n/2),c.closePath(),c}function p(e){if(v.selected){const t=v.nodes.get(v.selected),n=v.nodes.get("node0");v.nodes.set("node"+ ++v.counter,{parent:t,x:t.x+(t.x>n.x?200:-200),y:t.y+50,background:e&&e.background||"#f1f1f1",textColor:e&&e.textColor||"#808080",linkColor:e&&e.linkColor||"#9fad9c",font:e&&e.font||15,name:e&&e.name||"Node"}),d(),k.call("nodecreate")}}function m(){if("node0"!==v.selected){v.nodes.remove(v.selected);const e=function(t){v.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===t)return v.nodes.remove(n.key),void e(n.key)})};e(v.selected),v.selected="node0",s(),k.call("noderemove")}else console.warn("The root node can not be deleted")}function h(){v.svg.main.transition().duration(500).call(y.transform,t.zoomIdentity),k.call("mmcenter")}function g(e,t){const n=v.nodes.get(v.selected),o={name:f,default:function(){console.error('"'+e+'" is not a valid node property')}};(o[e]||o.default)(n,t)}const v={},y=t.zoom().scaleExtent([.5,2]).on("zoom",o),x=t.drag().on("drag",r).on("start",function(e){a(e.key)}),k=t.dispatch("mmcreate","mmcenter","nodeselect","nodecreate","noderemove","nodedblclick");e.mmap={init:n,center:h,addNode:p,removeNode:m,updateNode:g,events:k}}(this,window.d3);