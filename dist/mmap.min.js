!function(t,e){function n(t,n){const o=e.select(t),a=o.append("svg").attr("width","100%").attr("height","100%").append("g").call(f);a.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all"),d.mmap=a.append("g"),d.counter=0,d.nodes=[{id:"node"+d.counter,x:parseInt(o.style("width"))/2,y:parseInt(o.style("height"))/2,background:"#f5f5f5",color:"#8d9f8e",font:18,name:"Root node"}],i(d.nodes[0]),s()}function o(){d.mmap.attr("transform","translate("+e.event.transform.x+","+e.event.transform.y+")scale("+e.event.transform.k+")")}function a(t){const n=e.select(this);n.attr("transform","translate("+(t.x=e.event.x)+","+(t.y=e.event.y)+")"),e.selectAll(".link").attr("d",t=>r(t))}function r(t){return`M ${t.parent.x} ${t.parent.y-5}
            C ${(t.parent.x+t.x)/2} ${t.parent.y},
              ${(t.parent.x+t.x)/2} ${t.y},
              ${t.x-20} ${t.y+20}
            C ${(t.x+t.parent.x)/2+10} ${t.y},
              ${(t.x+t.parent.x)/2+10} ${t.parent.y},
              ${t.parent.x} ${t.parent.y+5}`}function s(){const t=d.nodes,n=d.mmap.selectAll(".node").data(t).each(t=>t.dom=e.select(this)),o=n.enter().append("g").attr("class","node").attr("transform",t=>"translate("+t.x+","+t.y+")").call(p),a=o.append("ellipse").style("fill",t=>t.background),s=o.append("text").text(t=>t.name).style("fill",t=>t.color).style("font-size",t=>t.font);a.attr("rx",parseInt(s.style("width"))/2+25),a.attr("ry",parseInt(s.style("height"))/2+16),s.attr("dy",parseInt(s.style("height"))/2-5),n.exit().remove();const l=d.mmap.selectAll(".link").data(t.slice(1));l.enter().insert("path","g").attr("class","link").style("fill",t=>t.color).style("stroke",t=>t.color).attr("d",t=>r(t)),l.exit().remove()}function l(t){d.selected&&d.selected.name&&(d.nodes.push({id:"node"+ ++d.counter,parent:d.selected,x:d.selected.x+200,y:d.selected.y+50,background:t.background||"#e6e6e6",color:t.color||"#6f6f6f",font:t.font||15,name:t.name||"Node"}),s())}function c(){return d.nodes}function i(t){d.selected=t}const d={},f=e.zoom().scaleExtent([.5,5]).on("zoom",o),p=e.drag().on("drag",a).on("start",function(t){i(t),e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).selectAll("ellipse").attr("stroke","#888888")});t.mmap={init:n,createNode:l,getNodes:c,selectNode:i}}(this,window.d3);