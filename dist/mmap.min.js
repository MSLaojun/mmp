!function(t,e){function n(t,n){const o=e.select(t),r=o.append("svg").attr("width","100%").attr("height","100%").append("g").call(u);r.append("rect").attr("width","100%").attr("height","100%").attr("fill","transparent").attr("pointer-events","all").on("mousedown",s),f.svg={main:r,mmap:r.append("g")},f.counter=0,f.nodes=[{id:"node"+f.counter,x:parseInt(o.style("width"))/2,y:parseInt(o.style("height"))/2,background:"#f5f5f5",color:"#8d9f8e",font:18,name:"Root node"}],p(f.nodes[0]),c()}function o(){f.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){e.selectAll(".node > ellipse").attr("stroke","none"),e.select(this).selectAll("ellipse").attr("stroke","#888888"),p(t)}function a(t){const n=e.select(this);n.attr("transform","translate("+(t.x=e.event.x)+","+(t.y=e.event.y)+")"),e.selectAll(".link").attr("d",t=>l(t))}function s(){e.selectAll(".node > ellipse").attr("stroke","none"),f.selected=f.nodes[0]}function l(t){const n=e.path();return n.moveTo(t.parent.x,t.parent.y-5),n.bezierCurveTo((t.parent.x+t.x)/2,t.parent.y,(t.parent.x+t.x)/2,t.y,t.x-20,t.y+20),n.bezierCurveTo((t.x+t.parent.x)/2+10,t.y,(t.x+t.parent.x)/2+10,t.parent.y,t.parent.x,t.parent.y+5),n.closePath(),n}function c(){const t=f.nodes,n=f.svg.mmap.selectAll(".node").data(t).each(t=>t.dom=e.select(this)),o=n.enter().append("g").attr("class","node").attr("transform",t=>"translate("+t.x+","+t.y+")").call(m),r=o.append("ellipse").style("fill",t=>t.background),a=o.append("text").text(t=>t.name).style("fill",t=>t.color).style("font-size",t=>t.font);r.attr("rx",parseInt(a.style("width"))/2+25),r.attr("ry",parseInt(a.style("height"))/2+14),a.attr("dy",parseInt(a.style("height"))/2-5),n.exit().remove();const s=f.svg.mmap.selectAll(".link").data(t.slice(1));s.enter().insert("path","g").attr("class","link").style("fill",t=>t.color).style("stroke",t=>t.color).attr("d",t=>l(t)),s.exit().remove()}function i(t){f.selected&&f.selected.name&&(f.nodes.push({id:"node"+ ++f.counter,parent:f.selected,x:f.selected.x+200,y:f.selected.y+50,background:t.background||"#e6e6e6",color:t.color||"#6f6f6f",font:t.font||15,name:t.name||"Node"}),c())}function d(){return f.nodes}function p(t){f.selected=t}const f={},u=e.zoom().scaleExtent([.5,2]).on("zoom",o),m=e.drag().on("drag",a).on("start",r);t.mmap={init:n,createNode:i,getNodes:d,selectNode:p}}(this,window.d3);