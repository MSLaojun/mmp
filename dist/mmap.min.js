!function(t,e){function n(t){z.container=e.select(t),z.svg={},z.svg.main=z.container.append("svg").attr("width","100%").attr("height","100%").attr("id","mmap").append("g").call(N),z.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",i),z.svg.mmap=z.svg.main.append("g"),z.nodes=e.map(),z.counter=0,z.nodes.set("node"+z.counter,{name:"Root node",x:parseInt(z.container.style("width"))/2,y:parseInt(z.container.style("height"))/2,"background-color":"#e6ede6","text-color":"#828c82","font-size":20}),d(),l("node0"),A.call("mmcreate")}function o(){z.svg.mmap.attr("transform",e.event.transform.toString())}function r(t){const n=t.x=e.event.x,o=t.y=e.event.y;e.select(this).attr("transform","translate("+n+","+o+")"),e.selectAll(".link").attr("d",t=>k(t))}function l(t){if(z.selected!==t||"node0"===z.selected){z.selected=t;const n=e.select("#"+t);e.selectAll(".node > ellipse").attr("stroke","none"),n.select("ellipse").attr("stroke","#587d53"),A.call("nodeselect",n.node(),z.nodes.get(t))}}function i(){l("node0"),e.selectAll(".node > ellipse").attr("stroke","none")}function c(t){for(var e=t.parent,n=0;e;)n++,e=e.parent;return n<5?n:5}function s(){const t=[];return z.nodes.each(function(e,n){e.key=n,t.push(e)}),t}function a(){e.selectAll(".node, .link").remove(),d()}function d(){const t=s(),n=z.svg.mmap.selectAll(".node").data(t),o=n.enter().append("g").attr("class","node").attr("id",t=>t.key).attr("transform",t=>"translate("+t.x+","+t.y+")").call(P).on("dblclick",function(t){A.call("nodedblclick",this,t),e.event.stopPropagation()});o.append("text").text(t=>t.name).attr("fill",t=>t["text-color"]).attr("font-size",t=>t["font-size"]).attr("font-style",t=>t["font-style"]).attr("font-weight",t=>t["font-weight"]),o.append("ellipse").style("fill",t=>t["background-color"]).attr("rx",function(t){return t.width=this.previousSibling.getBBox().width+40,t.width/2}).attr("ry",function(t){return t.height=11*t["font-size"]/10+30,t.height/2}),n.exit().remove(),e.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)});const r=z.svg.mmap.selectAll(".link").data(t.slice(1));r.enter().insert("path","g").attr("class","link").attr("id",t=>"linkOf"+t.key).style("fill",t=>t["link-color"]).style("stroke",t=>t["link-color"]).attr("d",t=>k(t)),r.exit().remove()}function f(t,e){const n=this.childNodes[1],o=this.childNodes[0];t.name=n.innerHTML=e,t.width=n.textLength.baseVal.value+40,o.setAttribute("rx",t.width/2)}function u(t,e){const n=this.childNodes[0];n.style.setProperty("fill",t["background-color"]=e)}function h(t,e){const n=this.childNodes[1];n.style.setProperty("fill",t["text-color"]=e)}function p(t,e){const n=this.childNodes[1];n.style.setProperty("font-size",t["font-size"]=e)}function m(t,e){const n=this.childNodes[1];n.style.setProperty("font-style",t["font-style"]=e)}function y(t,e){const n=this.childNodes[1];n.style.setProperty("font-weight",t["font-weight"]=e)}function g(t,e){if("node0"!==t.key){const n=document.getElementById("linkOf"+t.key);n.style.setProperty("fill",t["link-color"]=e),n.style.setProperty("stroke",t["link-color"]=e)}else console.warn("The root node has no branches")}function k(t){const n=30-5*c(t),o=t.parent.y<t.y?-1:1,r=t.parent.x>t.x?-1:1,l=(t.parent.x+t.x)/2,i=t.k=t.k||e.randomUniform(50)(),s=e.path();return s.moveTo(t.parent.x,t.parent.y-n/2),s.bezierCurveTo(l,t.parent.y-n/2,t.parent.x+i*r,t.y+t.height/2+5+i/10,t.x-(t.width/4-i/2)*r,t.y+t.height/2+5+i/10),s.bezierCurveTo(t.parent.x+i*r+n/2*o*r,t.y+t.height/2+n/2+5+i/10,l+n/2*o*r,t.parent.y+n/2,t.parent.x,t.parent.y+n/2),s.closePath(),s}function x(t){if(z.selected){const e=z.nodes.get(z.selected),n=z.nodes.get("node0"),o="node"+ ++z.counter,r={name:t&&t.name||"Node","background-color":t&&t["background-color"]||"#f1f1f1","text-color":t&&t["text-color"]||"#808080","link-color":t&&t["link-color"]||"#9fad9c","font-size":t&&t["font-size"]||16,"font-style":t&&t["font-style"]||"normal","font-weight":t&&t["font-weight"]||"normal",x:e.x+(e.x>n.x?200:-200),y:e.y+50,parent:e};z.nodes.set(o,r),d(),A.call("nodecreate")}}function v(){if("node0"!==z.selected){z.nodes.remove(z.selected);const t=function(e){z.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===e)return z.nodes.remove(n.key),void t(n.key)})};t(z.selected),z.selected="node0",a(),A.call("noderemove")}else console.warn("The root node can not be deleted")}function w(){z.svg.main.transition().duration(500).call(N.transform,e.zoomIdentity),A.call("mmcenter")}function b(t,e){const n=z.nodes.get(z.selected),o=document.getElementById(n.key),r={name:f,"background-color":u,"link-color":g,"text-color":h,"font-size":p,"font-style":m,"font-weight":y,default:function(){console.error('"'+t+'" is not a valid node property')}};(r[t]||r.default).call(o,n,e)}const z={},N=e.zoom().scaleExtent([.5,2]).on("zoom",o),P=e.drag().on("drag",r).on("start",function(t){l(t.key)}),A=e.dispatch("mmcreate","mmcenter","nodeselect","nodecreate","noderemove","nodedblclick");t.mmap={init:n,center:w,addNode:x,removeNode:v,updateNode:b,events:A}}(this,window.d3);