!function(e,t){function n(e){y.container=t.select(e),y.svg={},y.svg.main=y.container.append("svg").attr("width","100%").attr("height","100%").append("g").call(v),y.svg.main.append("rect").attr("width","100%").attr("height","100%").attr("fill","white").attr("pointer-events","all").on("mousedown",i),y.svg.mmap=y.svg.main.append("g"),y.nodes=t.map(),y.counter=0,y.nodes.set("node"+y.counter,{x:parseInt(y.container.style("width"))/2,y:parseInt(y.container.style("height"))/2,background:"#e6ede6",textColor:"#828c82",font:18,name:"Root node"}),c(),r("node0"),k.call("mmapCreated")}function o(){y.svg.mmap.attr("transform",t.event.transform.toString())}function r(e){if(y.selected!==e){y.selected=e;const n=t.select("#"+e);t.selectAll(".node > ellipse").attr("stroke","none"),n.select("ellipse").attr("stroke","#888888"),k.call("nodeSelected",n.node(),y.nodes.get(e))}}function a(e){const n=e.x=t.event.x,o=e.y=t.event.y;t.select(this).attr("transform","translate("+n+","+o+")"),t.selectAll(".link").attr("d",e=>l(e))}function i(){t.selectAll(".node > ellipse").attr("stroke","none"),y.selected="node0"}function d(e){for(var t=e.parent,n=0;t;)n++,t=t.parent;return n<5?n:5}function l(e){const n=30-5*d(e),o=e.parent.y<e.y?-1:1,r=e.parent.x>e.x?-1:1,a=(e.parent.x+e.x)/2,i=e.k=e.k||t.randomUniform(50)(),l=t.path();return l.moveTo(e.parent.x,e.parent.y-n/2),l.bezierCurveTo(a,e.parent.y-n/2,e.parent.x+i*r,e.y+e.height/2+5+i/10,e.x-(e.width/4-i/2)*r,e.y+e.height/2+5+i/10),l.bezierCurveTo(e.parent.x+i*r+n/2*o*r,e.y+e.height/2+n/2+5+i/10,a+n/2*o*r,e.parent.y+n/2,e.parent.x,e.parent.y+n/2),l.closePath(),l}function s(){const e=[];return y.nodes.each(function(t,n){t.key=n,e.push(t)}),e}function c(){const e=s(),n=y.svg.mmap.selectAll(".node").data(e),o=n.enter().append("g").attr("class","node").attr("id",e=>e.key).attr("transform",e=>"translate("+e.x+","+e.y+")").call(x);o.append("text").text(e=>e.name).attr("fill",e=>e.textColor).attr("font-size",e=>e.font).attr("dy",5),o.append("ellipse").style("fill",e=>e.background).attr("rx",function(e){return e.width=this.previousSibling.getBBox().width+40,e.width/2}).attr("ry",function(e){return e.height=this.previousSibling.getBBox().height+20,e.height/2}),n.exit().remove();const r=y.svg.mmap.selectAll(".link").data(e.slice(1));r.enter().insert("path","g").attr("class","link").style("fill",e=>e.linkColor).style("stroke",e=>e.linkColor).attr("d",e=>l(e)),r.exit().remove(),t.selectAll(".node > text").each(function(){this.parentNode.appendChild(this)})}function f(){t.selectAll(".node, .link").remove(),c()}function u(e,t){const n=document.getElementById(e.key),o=n.childNodes[1],r=n.childNodes[0];e.name=o.innerHTML=t,e.width=o.textLength.baseVal.value+40,r.setAttribute("rx",e.width/2)}function p(e){if(y.selected){const t=y.nodes.get(y.selected),n=y.nodes.get("node0");y.nodes.set("node"+ ++y.counter,{parent:t,x:t.x+(t.x>n.x?200:-200),y:t.y+50,background:e&&e.background||"#f1f1f1",textColor:e&&e.textColor||"#808080",linkColor:e&&e.linkColor||"#9fad9c",font:e&&e.font||15,name:e&&e.name||"Node"}),c(),k.call("nodeCreated")}}function m(){if("node0"!==y.selected){y.nodes.remove(y.selected);const e=function(t){y.nodes.each(function(n){if("node0"!==n.key&&n.parent.key===t)return y.nodes.remove(n.key),void e(n.key)})};e(y.selected),y.selected="node0",f(),k.call("nodeRemoved")}else console.warn("The root node can not be deleted")}function h(){y.svg.main.transition().duration(500).call(v.transform,t.zoomIdentity),k.call("mmapCentred")}function g(e,t){const n=y.nodes.get(y.selected),o={name:u,default:function(){console.error('"'+e+'" is not a valid node property')}};(o[e]||o.default)(n,t)}const y={},v=t.zoom().scaleExtent([.5,2]).on("zoom",o),x=t.drag().on("drag",a).on("start",function(e){r(e.key)}),k=t.dispatch("mmapCreated","mmapCentred","nodeSelected","nodeCreated","nodeRemoved");e.mmap={init:n,center:h,addNode:p,removeNode:m,updateNode:g,events:k}}(this,window.d3);